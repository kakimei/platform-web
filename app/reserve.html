<!DOCTYPE html>
<html ng-app="reserve" lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,height=device-height,inital-scale=1.0" />
    <style>
      body {
        height: 800px;
      }

      .header {
        width: 100%;
        height: 5%;
        background-color: lightblue;
      }

      .main {
        float: right;
        width: 100%;
        height: 75%;
        background-color: whitesmoke;
      }

      .footer {
        clear: both;
        width: 100%;
        height: 10%;
        background-color: darkgray;
      }

      .btn.blue { background: #2ae; }
      .btn.gray { background: #b5b5b5; }

    </style>
    <script src="https://code.angularjs.org/1.7.5/angular.min.js"></script>
    <script src="https://code.angularjs.org/1.7.5/angular-cookies.min.js"></script>
    <script>
      var app = angular.module("reserve", ['ngCookies']);
      app.controller('reserveController', function ($cookies, $scope, $http) {
        $scope.reserveVO.linkManName="";
        $scope.reserveVO.sex = "MALE";
        $scope.reserveVO.age = "";
        $scope.reserveVO.phoneNumber = "";
        $scope.reserveVO.peopleCount = "";
        $scope.reserveVO.activityType = "TEAM";
        $scope.reserveForm = function () {
          $http({
            method: 'POST',
            url: 'http://yp.compass-trip.com:8081/platform/reserve?token='+$cookies.get('token'),
            data: {
              "reservationInfoId": null,
              "linkManName": $scope.reserveVO.linkManName,
              "sex": $scope.reserveVO.sex,
              "age": $scope.reserveVO.age,
              "phoneNumber": $scope.reserveVO.phoneNumber,
              "reserveBegin": $scope.reserveVO.reserveBegin,
              "reserveEnd": $scope.reserveVO.reserveEnd,
              "peopleCount": $scope.reserveVO.peopleCount,
              "activityType": $scope.reserveVO.activityType
            },
            headers: {
              'Content-Type': 'application/json',
              'Accept': 'application/json'
            }
          }).then(function (resp) {
            if(resp.data == true){
              alert("预约成功！");
              self.location='reservationList.html';
            }else{
              alert("预约失败！");
            }
          }, function (resp) {
            alert("预约失败！服务调用失败！跳转到登录页面");
            self.location='login.html';
          });
        };

        $scope.logout = function () {
          $cookies.put("user", null);
          $cookies.put("token", null);
          location.href = 'login.html';
        };

      });
    </script>
    <title>资源预约</title>
  </head>
  <body>
    <div class="header">预约系统</div>
    <div ng-controller="reserveController as reserveVO" class="main" data-ng-init="load()">
      <form ng-submit="reserveForm()">
        联系人姓名:<input type="text" ng-model="reserveVO.linkManName" required/> <br />
        性别:
        <input name="sex" type="radio" ng-model="reserveVO.sex" value="MALE"/>男
        <input name="sex" type="radio" ng-model="reserveVO.sex" value="FEMALE"/>女<br />
        年龄:<input type="number" ng-maxlength="2" ng-model="reserveVO.age" /> <br />
        电话号码:<input type="text" ng-maxlength="15" ng-model="reserveVO.phoneNumber" required/> <br />
        预约开始日期:<input type="date" ng-model="reserveVO.reserveBegin" required/> <br />
        预约结束日期:<input type="date" ng-model="reserveVO.reserveEnd" required/> <br />
        预约人数:<input type="number" ng-maxlength="4" ng-model="reserveVO.peopleCount" required/> <br />
        预约类型:
        <input name="activityType" type="radio" ng-model="reserveVO.activityType" value="TEAM"/>团队
        <input name="activityType" type="radio" ng-model="reserveVO.activityType" value="SINGLE" />个人<br />
        <button type="submit" class="btn blue">预约</button>
        <button type="button" class="btn gray" ng-click="logout()">退出</button>
      </form>
    </div>
  </body>
</html>