<!DOCTYPE html>
<html ng-app="reservationList" lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,height=device-height,inital-scale=1.0" />
    <style>
      body {
        height: 800px;
      }

      .header {
        width: 100%;
        height: 5%;
        background-color: lightblue;
      }

      .main {
        float: right;
        width: 100%;
        height: 75%;
        background-color: whitesmoke;
      }

      .footer {
        clear: both;
        width: 100%;
        height: 10%;
        background-color: darkgray;
      }

      .btn.blue { background: #2ae; }

      table, td  {
        border: 1px solid grey;
        border-collapse: collapse;
        padding: 5px;
      }
    </style>
    <script src="https://code.angularjs.org/1.7.5/angular.min.js"></script>
    <script src="https://code.angularjs.org/1.7.5/angular-cookies.min.js"></script>

    <script>
      var app = angular.module("reservationList", ['ngCookies']);
      app.controller('reservationListController', function ($cookies, $scope, $http) {
        $scope.reservationListForm={};
        $scope.activityT= {
          "TEAM":"团",
          "SINGLE":"个"
        };
        $scope.sexT= {
          "MALE":"男",
          "FEMALE":"女"
        };
        $scope.load = function () {
          $http({
            method: 'GET',
            url: 'http://yp.compass-trip.com/platform/reserve/list?token='+$cookies.get('token'),
            headers: {
              'Content-Type': 'application/json',
              'Accept': 'application/json'
            }
          }).then(function (resp) {
            $scope.reservationListForm = resp.data;
          }, function (resp) {
            alert("获取列表失败！服务调用失败！");
            self.location='login.html';
          });
        };
        $scope.reserve = function () {
          self.location='reserve.html';
        };
        $scope.modify = function (reservationId) {
          var hre = 'reservationModify.html?reservationInfoId=' + reservationId;
          location.href = hre;
        };

        $scope.allReservation = function () {
          var hre = 'allReservation.html';
          location.href = hre;
        };
      });

    </script>
    <title>预约记录一览</title>
  </head>
  <body>
    <div class="header">预约记录一览</div>
    <div ng-controller="reservationListController as reservationListVO" class="main" data-ng-init="load()">
      <table>
        <tr>
          <th>联系人</th>
          <th>类型</th>
          <th>电话</th>
          <th>开始日</th>
          <th>结束日</th>
          <th></th>
        </tr>
        <tr ng-repeat="item in reservationListForm">
          <td hidden>{{item.reservationInfoId}}</td>
          <td hidden>{{item.signIn}}</td>
          <td ng-if="$odd" style="background-color:#f1f1f1">{{item.linkManName}}</td>
          <td ng-if="$even">{{item.linkManName}}</td>
          <td ng-if="$odd" style="background-color:#f1f1f1">{{activityT[item.activityType]}}</td>
          <td ng-if="$even">{{activityT[item.activityType]}}</td>
          <td ng-if="$odd" style="background-color:#f1f1f1">{{item.phoneNumber}}</td>
          <td ng-if="$even">{{item.phoneNumber}}</td>
          <td ng-if="$odd" style="background-color:#f1f1f1">{{item.reserveBegin | date:'MM/dd'}}</td>
          <td ng-if="$even">{{item.reserveBegin | date:'MM/dd'}}</td>
          <td ng-if="$odd" style="background-color:#f1f1f1">{{item.reserveEnd | date:'MM/dd'}}</td>
          <td ng-if="$even">{{item.reserveEnd | date:'MM/dd'}}</td>
          <td ng-if="$odd" style="background-color:#f1f1f1">
            <button type="button" class="btn blue" ng-click="modify(item.reservationInfoId)">详情</button>
          </td>
          <td ng-if="$even">
            <button type="button" class="btn blue" ng-click="modify(item.reservationInfoId)">详情</button>
          </td>
        </tr>
      </table>
      <button type="button" class="btn blue" ng-click="reserve()">预定</button>
      <button type="button" class="btn blue" ng-click="allReservation()">所有活动</button>
    </div>
  </body>
</html>