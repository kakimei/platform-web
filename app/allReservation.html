<!DOCTYPE html>
<html ng-app="allReservation" lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,height=device-height,inital-scale=1.0" />
    <style>
      body {
        height: 800px;
      }

      .header {
        width: 100%;
        height: 5%;
        background-color: lightblue;
      }

      .main {
        float: right;
        width: 100%;
        height: 75%;
        background-color: whitesmoke;
      }

      .footer {
        clear: both;
        width: 100%;
        height: 10%;
        background-color: darkgray;
      }

      .btn.blue { background: #2ae; }

      table, td  {
        border: 1px solid grey;
        border-collapse: collapse;
        padding: 5px;
      }
    </style>
    <script src="https://code.angularjs.org/1.7.5/angular.min.js"></script>
    <script src="https://code.angularjs.org/1.7.5/angular-cookies.min.js"></script>

    <script>
      var app = angular.module("allReservation", ['ngCookies']);
      app.controller('allReservationController', function ($cookies, $scope, $http) {
        $scope.reservationListForm={};
        $scope.activityT= {
          "TEAM":"团",
          "SINGLE":"个"
        };
        $scope.sexT= {
          "MALE":"男",
          "FEMALE":"女"
        };
        $scope.load = function () {
          $http({
            method: 'GET',
            url: 'http://yp.compass-trip.com/platform/reserve/alllist?token='+$cookies.get('token'),
            headers: {
              'Content-Type': 'application/json',
              'Accept': 'application/json'
            }
          }).then(function (resp) {
            $scope.reservationListForm = resp.data;
          }, function (resp) {
            alert("获取列表失败！服务调用失败！");
            self.location='login.html';
          });
        };

        $scope.back = function () {
          self.location='reservationList.html';
        };

        $scope.feedback = function (reservationInfoId) {
          $http({
            method: 'POST',
            url: 'http://yp.compass-trip.com/platform/feedback/thumbsUp?token='+$cookies.get('token'),
            data: {
              "reservationInfoId": reservationInfoId,
              "feedBackType": "GOOD"
            },
            headers: {
              'Content-Type': 'application/json',
              'Accept': 'application/json'
            }
          }).then(function (resp) {
            if(resp.data){
              $scope.load();
            }
          }, function (resp) {
            alert("获取列表失败！服务调用失败！");
            self.location='login.html';
          });
        };

      });

    </script>
    <title>活动一览</title>
  </head>
  <body>
    <div class="header">活动一览</div>
    <div ng-controller="allReservationController as reservationListVO" class="main" data-ng-init="load()">
      <table>
        <tr>
          <th>联系人</th>
          <th>类型</th>
          <th>开始日</th>
          <th>结束日</th>
          <th>人气</th>
          <th></th>
        </tr>
        <tr ng-repeat="item in reservationListForm">
          <td hidden>{{item.reservationInfoId}}</td>
          <td hidden>{{item.signIn}}</td>
          <td ng-if="$odd" style="background-color:#f1f1f1">{{item.linkManName}}</td>
          <td ng-if="$even">{{item.linkManName}}</td>
          <td ng-if="$odd" style="background-color:#f1f1f1">{{activityT[item.activityType]}}</td>
          <td ng-if="$even">{{activityT[item.activityType]}}</td>
          <td ng-if="$odd" style="background-color:#f1f1f1">{{item.reserveBegin | date:'MM/dd'}}</td>
          <td ng-if="$even">{{item.reserveBegin | date:'MM/dd'}}</td>
          <td ng-if="$odd" style="background-color:#f1f1f1">{{item.reserveEnd | date:'MM/dd'}}</td>
          <td ng-if="$even">{{item.reserveEnd | date:'MM/dd'}}</td>
          <td ng-if="$odd" style="background-color:#f1f1f1">{{item.feedBack}}</td>
          <td ng-if="$even">{{item.feedBack}}</td>
          <td ng-if="$odd" style="background-color:#f1f1f1">
            <button type="button" class="btn blue" ng-click="feedback(item.reservationInfoId)">赞</button>
          </td>
          <td ng-if="$even">
            <button type="button" class="btn blue" ng-click="feedback(item.reservationInfoId)">赞</button>
          </td>
        </tr>
      </table>
      <button type="button" class="btn blue" ng-click="back()">返回</button>
    </div>
  </body>
</html>