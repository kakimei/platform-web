<!DOCTYPE html>
<html ng-app="allReservation" lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,height=device-height,inital-scale=1.0" />
    <link rel="stylesheet" href="css/default.css">
    <link rel="stylesheet" href="css/button.css">
    <link href="http://cdn.bootcss.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
    <script src="https://code.angularjs.org/1.7.5/angular.min.js"></script>
    <script src="https://code.angularjs.org/1.7.5/angular-cookies.min.js"></script>

    <script>
      var app = angular.module("allReservation", ['ngCookies']);
      app.controller('allReservationController', function ($cookies, $scope, $http) {
        $scope.reservationListForm = {};
        $scope.activityT = {
          "TEAM": "团",
          "SINGLE": "个"
        };
        $scope.sexT = {
          "MALE": "男",
          "FEMALE": "女"
        };
        $scope.load = function () {
          $http({
            method: 'GET',
            url: 'http://yp.compass-trip.com:8081/platform/reserve/alllist?token=' + $cookies.get('token'),
            headers: {
              'Content-Type': 'application/json',
              'Accept': 'application/json'
            }
          }).then(function (resp) {
            $scope.reservationListForm = resp.data;
          }, function (resp) {
            alert("获取列表失败！服务调用失败！");
            self.location = 'login.html';
          });
        };

        $scope.back = function () {
          self.location = 'reservationList.html';
        };

        $scope.feedback = function (reservationInfoId) {
          $http({
            method: 'POST',
            url: 'http://yp.compass-trip.com:8081/platform/feedback/thumbsUp?token=' + $cookies.get('token'),
            data: {
              "reservationInfoId": reservationInfoId,
              "feedBackType": "GOOD"
            },
            headers: {
              'Content-Type': 'application/json',
              'Accept': 'application/json'
            }
          }).then(function (resp) {
            if (resp.data) {
              $scope.load();
            }
          }, function (resp) {
            alert("获取列表失败！服务调用失败！");
            self.location = 'login.html';
          });
        };

        $scope.logout = function () {
          $cookies.put("user", null);
          $cookies.put("token", null);
          location.href = 'login.html';
        };

      });

    </script>
    <title>活动一览</title>
  </head>
  <body>
    <div class="header">
      <div>
        <a class="home" href="reservation.html" title="预约"><i></i></a>
        <a class="more" href="reservationList.html" title="预约一览"><i></i></a>
        <span id="lblTitle">活动一览</span>
      </div>
    </div>
    <div>
      <img class="header-image" src="img/hd-bg.jpeg">
    </div>
    <div class="middle">
      <div ng-controller="allReservationController as reservationListVO" class="main" data-ng-init="load()">
        <div>
          <table class=table8_1 style="margin-top: 10px">
            <tr>
              <th style="background-color:#fcc80a">联系人</th>
              <th style="background-color:#fcc80a">类型</th>
              <th style="background-color:#fcc80a">开始日</th>
              <th style="background-color:#fcc80a">结束日</th>
              <th style="background-color:#fcc80a">人气</th>
              <th style="background-color:#fcc80a"></th>
            </tr>
            <tr ng-repeat="item in reservationListForm">
              <td hidden>{{item.reservationInfoId}}</td>
              <td hidden>{{item.signIn}}</td>
              <td ng-if="$odd" style="background-color:lightgray">{{item.linkManName}}</td>
              <td ng-if="$even">{{item.linkManName}}</td>
              <td ng-if="$odd" style="background-color:lightgray">{{activityT[item.activityType]}}</td>
              <td ng-if="$even">{{activityT[item.activityType]}}</td>
              <td ng-if="$odd" style="background-color:lightgray">{{item.reserveBegin | date:'MM/dd'}}</td>
              <td ng-if="$even">{{item.reserveBegin | date:'MM/dd'}}</td>
              <td ng-if="$odd" style="background-color:lightgray">{{item.reserveEnd | date:'MM/dd'}}</td>
              <td ng-if="$even">{{item.reserveEnd | date:'MM/dd'}}</td>
              <td ng-if="$odd" style="background-color:lightgray">{{item.feedBack}}</td>
              <td ng-if="$even">{{item.feedBack}}</td>
              <td ng-if="$odd" style="background-color:lightgray">
                <button class="button button-3d button-box button-jumbo button-tiny" ng-click="feedback(item.reservationInfoId)"><i class="fa fa-thumbs-up"></i></button>
              </td>
              <td ng-if="$even">
                <button class="button button-3d button-box button-jumbo button-tiny" ng-click="feedback(item.reservationInfoId)"><i class="fa fa-thumbs-up"></i></button>
              </td>
            </tr>
          </table>
          <button type="button" class="button button-glow button-rounded button-raised button-primary button-tiny" style="margin-bottom: 10px" ng-click="back()">返回</button>
          <button type="button" class="button button-glow button-border button-rounded button-primary button-tiny" style="margin-bottom: 10px" ng-click="logout()">退出</button>
        </div>
      </div>
    </div>
  </body>
</html>